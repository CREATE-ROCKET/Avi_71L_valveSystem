# 通信プロトコルの仕様
| head(1byte) | command(1byte) | length(1byte)    | parameters(nbyte) |
|-------------|----------------|------------------|-------------------|
| 0x71        |                | n+3              |                   |

通信コマンドはackと組み立て時バルブ開閉だけにしたい

点火シーケンス前は1Hzのackを流し，点火シーケンス中は100Hzのackを流す

通信エラーの際，マイコン側で特になにもしない．

## 1. PC
### 1.1. コントローラ基板に対する送信(ack)
準備時は1Hzで送信する．点火シーケンス時は100Hzでの送信に切り替わる．

`D`...バルブ基板をスタートさせるか，`1`の場合スタートさせ，`0`の場合light sleepさせる．

コントローラ基板に対し2.1.を発行させ，10ms 以内に2.2. がない場合異常と判断する．

## 2. コントローラ基板
### 2.1. 中継基板に対する送信
1.1. をもって発行する．
| head(1byte) | data(1byte) |
|-------------|-------------|
| 0x71        | 0bDEFGHPPP  |

`D`...バルブ基板をスタートさせるか，`1`の場合スタートさせ，`0`の場合light sleepさせる．

`EFGH`...それぞれ外部ダンプ，内部ダンプ，充填，点火スイッチのステータス．`0b1`の場合ONで，`0b0`の場合OFF．

`P`...パリティで，`D`の反転

`PP`...パリティで，DEFGのうち`0b1`のものの数

中継基板に3.1. を発行させ，10ms 以内に3.2. がない場合異常と判断する．

### 2.2. PCに対する送信(ack)

## 3. 中継基板
### 3.1. ロケット搭載基板に対する送信
2.1. をもって発行する．


ロケット搭載基板に4.1. を発行させ，10ms 以内に3.2. がない場合異常と判断する．

### 3.2. コントローラ基板に対する送信


## 4. ロケット搭載基板
### 4.1. 中継基板に対する送信
3.1. をもって発行する．
| head(1byte) | time(2byte)   |status(1byte) | cntr(2byte)  |
|-------------|---------------|--------------|--------------|
| 0x71        | raw(us)       |0bX           |16bit pcnt raw|

`X`...ロケット搭載基板がスタートしているかどうか，`1`ならスタートしており，`0`ならLight sleep中である．